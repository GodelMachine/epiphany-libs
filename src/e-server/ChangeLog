2014-02-06  Jeremy Bennett  <jeremy.bennett@embecosm.com>

	* src/GdbServer.cpp (GdbServer::GdbServer): Set all
	member variables in prototype.
	(GdbServer::~GdbServer): Remove call to releaseGdbCmdSelectedCoreId.
	(GdbServer::rspAttach): Rewritten to not reset and remove
	commented out code.
	(GdbServer::rspDetach): Remove call to releaseGdbCmdSelectedCoreId
	and remove commented out code.
	(GdbServer::rspServer): Tidy up error messages, remove mutex.
	(GdbServer::rspClientRequest): Tidy up error messages
	(GdbServer::redirectSdioOnTrap): Remove mutex.
	(GdbServer::targetHalt): Rewritten from scratch.
	(GdbServer::targetSwReset): Renamed from targetSWReset.
	* src/GdbServer.h: Reorder memver variables, rename
	targetSWReset as targetSwReset.
	(RspConnection::getBreakCommand): Renamed from GetBreakCommand,
	tidy up error messages.
	* src/RspConnection.h: Rename GetBreakCommand as
	getBreakCommand.

2014-02-05  Jeremy Bennett  <jeremy.bennett@embecosm.com>

	* src/GdbServer.cpp (GdbServer::rspServer): Remove CoreID from
	messages.
	(GdbServer::rspClientRequest): Likewise.
	(GdbServer::rspReportException): Likewise.
	(GdbServer::targetResume): Likewise.
	(GdbServer::rspContinue): Likewise.
	(GdbServer::rspSuspend): Likewise.
	(GdbServer::rspFileIOreply): Likewise.
	(GdbServer::redirectSdioOnTrap): Likewise.
	(GdbServer::rspReadAllRegs): Likewise.
	(GdbServer::rspQuery): Likewise.
	(GdbServer::rspCommand): Likewise.
	(GdbServer::rspStep): Likewise.
	(GdbServer::getAttachedTargetCoreId): Deleted.
	(GdbServer::targetHalt): Remove CoreID from messages.
	(GdbServer::putBreakPointInstruction): Likewise.
	* src/GdbServer.h: Deleted getAttachedTargetCoreId.
	* src/TargetControl.cpp	(TargetControl::initAttachedCoreId): Deleted.
	(TargetControl::getAttachedCoreId): Likewise.
	(TargetControl::setAttachedCoreId): Likewise.
	* src/TargetControl.h: Deleted initAttachedCoreId,
	getAttachedCoreId and setAttachedCoreId.
	* src/TargetControlHardware.cpp
	(TargetControlHardware::readBurst): Replace dynamically loaded
	function references by wrapper functions.
	(TargetControlHardware::writeBurst): Completely rewritten for
	clarity and debug visibility.
	(TargetControlHardware::platformReset): Replace dynamically loaded
	function references by wrapper functions.
	(TargetControlHardware::breakSignalHandler): Likewise.
	(TargetControlHardware::initHwPlatform): Rename private names of
	links, replace dynamically loaded function references by wrapper
	functions.
	(TargetControlHardware::initMaps): Set sensible default
	currentCoreId, clean up error message.
	(TargetControlHardware::showMaps): Better layout of messages.
	(TargetControlHardware::getTargetId): Replace dynamically loaded
	function references by wrapper functions.
	(TargetControlHardware::convertAddress): Better error message.
	(TargetControlHardware::readMem): Replace dynamically loaded
	function references by wrapper functions.
	(TargetControlHardware::writeMem): Likewise.
	(TargetControlHardware::initPlatform): Created.
	(TargetControlHardware::closePlatform): Created.
	(TargetControlHardware::writeTo): Created.
	(TargetControlHardware::readFrom): Created.
	(TargetControlHardware::hwReset): Created.
	(TargetControlHardware::getDescription): Created.
	* src/TargetControlHardware.h: Add initPlatform, closePlatform,
	writeTo, readFrom, hwReset and getDescription wrapper functions,
	rename pointers to dynamically loaded functions.
	* src/main.cpp (main): No INFO messages for debug settings.

2014-02-04  Jeremy Bennett  <jeremy.bennett@embecosm.com>

	* src/ServerInfo.cpp (ServerInfo::debugStopResume):
	Mask for flag using AND rather than OR.
	(ServerInfo::debugTrapAndRspCon): Likewise.
	(ServerInfo::debugStopResumeDetail): Likewise.
	(ServerInfo::debugTargetWr): Likewise.
	(ServerInfo::debugCtrlCWait): Likewise.
	(ServerInfo::debugTranDetail): Likewise.

2014-02-04  Jeremy Bennett  <jeremy.bennett@embecosm.com>

	* Release/src/subdir.mk: Add src/MemRange.cpp, src/MemRange.o and
	src/MemRange.d.
	* src/ServerInfo.cpp (ServerInfo::ServerInfo): Replace
	dontCheckHwAddrFlag with checkHwAddrFlag and invert default.
	(ServerInfo::dontCheckHwAddr): Renamed as checkHwAddr.
	(ServerInfo::checkHwAddr): Replaces dontCheckHwAddr.
	* src/ServerInfo.h: Replace dontCheckHwAddr by checkHwAddr throughout.
	* src/TargetControlHardware.cpp
	(TargetControlHardware::TargetControlHardware): Remove
	_indexInMemMap param.
	(TargetControlHardware::readBurst): Replace call to
	si->dontCheckHwAddr by call to si->checkHwAddr and invert result.
	(TargetControlHardware::writeBurst): Likewise.
	(TargetControlHardware::getMemoryMap): Deleted.
	(TargetControlHardware::getRegisterMap): Deleted.
	(TargetControlHardware::initAttachedCoreId): Deleted.
	(TargetControlHardware::setAttachedCoreId): Deleted.
	(TargetControlHardware::initDefaultMemoryMap): Deleted.
	(TargetControlHardware::initMaps): Created.
	(TargetControlHardware::showMaps): Created.
	(TargetControlHardware::convertAddress): Rewritten to use
	currentCoreId and new memory maps.
	(TargetControlHardware::readMem): Replace call to
	si->dontCheckHwAddr by call to si->checkHwAddr and invert result.
	(TargetControlHardware::writeMem): Likewise.
	* src/TargetControlHardware.h (class TargetControlHardware):
	Remove _indexInMemMap param to consturctor.  Delete member
	functions getMemoryMap, getRegisterMap, initAttachedCoreId,
	setAttachedCoreId and initDefaultMemoryMap.  Add member functions
	initMaps and showMaps.  Remove member variables indexInMemMap,
	memory_map and register_map.  Add membervariables coreMap,
	coreMemMap, reverseCoreMemMap, extMemSet and currentCoreId.
	* src/main.cpp (usage_summary): Add missing options and change
	--dont-check-hw-address to --check-hw-address.
	(usage_full): Change --dont-check-hw-address to
	--check-hw-address.
	(showMaps): Deleted.
	(initPlatform): Use initMaps for tCntrl initialzation and tCntrl
	showMaps function instead of local function.
	(main): Change argument --dont-check-hw-address to
	--check-hw-address.

2014-02-03  Jeremy Bennett  <jeremy.bennett@embecosm.com>

	* src/main.cpp (usage_summary): Created from initial part of usage.
	(usage): Deleted
	(usage_full): Created from all but initial part of usage.
	(initPlatform): Call usage_summary instead of usage.
	(main): Call usage_summary instead of usage, except in the case of
	-h/--help when we call usage_full. Deal with case of unrecognized
	arguments, which were previously silently ignored.

2014-02-03  Jeremy Bennett  <jeremy.bennett@embecosm.com>

	* src/ServerInfo.cpp: portNum initialized to
	DEFAULT_RSP_PORT.
	* src/ServerInfo.h: Define DEFAULT_RSP_PORT.
	* src/main.cpp (initPlatform): Do not delete xml at
	end of function, since it causes stack corruption. BUG TO BE FIXED.

2014-02-03  Jeremy Bennett  <jeremy.bennett@embecosm.com>

	* src/ServerInfo.cpp (ServerInfo::ServerInfo): Initialize
	halDebugLevel.
	(ServerInfo::halDebug): Created (two versions).
	* src/ServerInfo.h: Include epiphany-hal-data from e-hal. New
	accessor methods halDebug (set and get), and new private data
	halDebugLevel.
	* src/TargetControlHardware.cpp
	(TargetControlHardware::initHwPlatform): initialize platform using
	halDebug from ServerInfo. No need to call e_set_host_verbosity,
	since called from init.
	* src/main.cpp (usage): Document new flag --hal-debug
	(main): Capture --hal-debug value.

2014-01-28  Jeremy Bennett  <jeremy.bennett@embecosm.com>

	* Release/src/subdir.mk: Added reference to ServerInfo.c,
	ServerInfo.o and ServerInfo.d.
	* src/debugVerbose.h: Deleted.
	* src/GdbServer.cpp: Replace references to rspPort by si->port
	throughout, replace references to haltOnAttach by si->haltOnAttach
	throughout, replace references to ttyOut by si->ttyOut throughout,
	replace references to debug_level by calls to ServerInfo debug
	accessors throughout.
	(GdbServer): Initalize from ServerInfo, pass ServerInfo to
	RspConnection.
	* src/GdbServer.h: Constructor takes just ServerInfo as parameter,
	remove rspPort, haltOnAttach and ttyOut and replace by si, remove
	external ref to debug_level and include of debugVerbose.h.
	* src/RspConnection.cpp: Include ServerInfo.h
	(RspConnection): Take ServerInfo and sole parameter and extract
	portNum from this, remover overloaded version taking serviceName
	parameter, since nevery used.
	(rspInit): Remove serviceName parameter.
	(getPkt, putPkt): Replace debug_level by debugTrapAndRspConn.
	* src/RspConnection.h: Include ServerInfo.h, pass ServerInfo as
	sole paramter to RspConnection, and remove variant constructor
	with service name, remove serviceName parameter from rspInit, add
	private member to point to ServerInfo, remove serviceName.
	* src/ServerInfo.cpp: Created.
	* src/ServerInfo.h: Created.
	* src/TargetControlHardware.cpp: Remove incldue of debugVerbose
	and add include of maddr_defs.h
	(TargetControlHardware): Pass ServerInfo instead of
	dontCheckHwAddr and skipPlatformReset.
	(readBurst, writeBurst): Replace dontCheckHwAddr with ref to
	ServerInfo.
	(initHwPlatform): Replace debug_level with ServerInfo
	debugTrapAndRspCon, replace skipPlatformReset with ref to
	ServerInfo
	(readMem, writeMem): Replace dontCheckHwAddr with ref to
	ServerInfo, replace debug_level with ServerInfo debugTargetWr
	* src/TargetControlHardware.h: Initialize constructor with
	ServerInfo instead of flags, remove CORE_SPACE, add si member var.
	* src/main.cpp: Include ServerInfo:
	(PORT_BASE_NUM, TTY_, debug_level): Deleted.
	(usage): Add new debug flags.
	(showMaps): Renamed from showMemoryMap, add ServerInfo parameter.
	(initPlatform): Pass all but last arg as ServerInfo class, pass on
	to tCntrl and showMaps.
	(main): Create ServerInfo instance and repace corresponding flags
	throughout - doShowMemoryMap, skipPlatformReset,
	dontCheckHwAddress,haltOnAttach, ttyOut, PORT_BASE_NUN.  Remove
	withTtySupport - now use NULL ttyOut instead, validate port
	number, use named debug flags.

2014-01-28  Jeremy Bennett  <jeremy.bennett@embecosm.com>

	* Release/src/subdir.mk: Added TargetControl.cpp.
	* src/GdbServer.cpp: Put contributors in header, tidy up
	organization of included headers.
	(rspServer, rspClientRequest, rspReportException, targetResume)
	(getAttachedTargetCoreId): Use getAttachedCoreId rather than
	GetAttachedCoreId.
	(rspReadAllRegs, rspReadMem): use startOfBaudMeasurement member
	function instead of StartOfBaudMeasurement, rename ReadBurst to
	readBurst, use endOfBaudMeasurement member function instead of
	EndOfBaudMeasurement.
	(rspWriteMem, rspWriteMemBin, restoreIVT): Rename WriteBurst to
	writeBurst.
	(rspQuery): Rename SetAttachedTargetCoreId as
	setAttachedTargetCoreId
	(isTargetInIldeState): Rename ReadBurst to readBurst.
	(targetHWReset): Rename PlatformReset to platformReset.
	* src/GdbServer.h: Put contributors in header, make guard macro
	naming consistent.
	* src/TargetControl.cpp: Created.
	* src/TargetControl.h: Put contributors in header, include
	sys/time.h, remove local typedefs of uint32_t, uint8_t and
	uint16_t, rename WriteBurst as writeBurst, ReadBurst as readBurst,
	PlatformReset as platformReset and ResumeAndExit as resumeAndExit
	for consistency, add initAttachedCoreId, add E_BYTE_BYTES,
	E_SHORT_BYTES, E_WORD_BYTES and E_DOUBLE_BYTES, make
	convertAddress a member function, add startTime as member
	variable.
	* src/TargetControlHardware.cpp: Put contributors in header,
	remove enum of _BYTE_, _SHORT_, _WORD_ and _DOUBLE_ and replace by
	E_BYTE_BYTES, E_SHORT_BYTES, E_WORD_BYTES and E_DOUBLE_BYTES
	throughout, tidy up headers and remove duplicate includes, add
	explicit using declarations.
	(init_platform, close_platform, write_to, read_from, hw_reset)
	(get_description, get_memory_map, get_number_supported_cores)
	(set_chip_x_y, e_open, e_close, e_read, e_write, e_reset)
	(e_set_host_verbosity): Deleted and replaced by member variables.
	(IsAddressLocal): Deleted.
	(CORE_SPACE): Deleted and replaced by member constant.
	(PlatformReset): Deleted and replaced by platformReset throughout.
	(platformReset): Created from PlatformReset.
	(ReadBurst): Deleted and replaced by readBurst throughout.
	(readBurst): Created from ReadBurst.
	(WriteBurst): Deleted and replaced by writeBurst throughout.
	(writeBurst): Created from WriteBurst.
	(SetAttachedCoreId): Deleted and replaced by setAttachedCoreId
	throughout.
	(setAttachedCoreId): Created from SetAttachedCoreId.
	(GetTargetId): Deleted and replaced by getTargetId throughout.
	(getTargetId): Created from GetTargetId.
	(ConvertAddress): Deleted and replaced by member function
	convertAddress throughout.
	(convertAddress): Created from ConvertAddress.
	(TargetControlHardware): Add parameters for command line switches
	instead of using global variables.
	(dontCheckHwAddr): Renamed from dontCheckHwAddress throughout.
	(BreakSignalHander): Deleted and replaced by static member
	function breakSignalHander.
	(breakSignalHandler): Created, and all references to member
	variables commented out.
	(initHwPlatform): Made member function, use helper to find DSO
	entries.
	(initDefaultMemoryMap): Made member function.
	(initAttachedCoreId): Created
	(startOfBaudMeasurement, endOfBaudMeasurement, findSharedFunc)
	(getMemoryMap, getRegisterMap): Created.
	* src/TargetControlHardware.h: Extend constructor arguments,
	rename WriteBurst as writeBurst, ReadBurst as readBurst,
	PlatformReset as platformReset, SetAttachedCoreId as
	setAttachedCoreId, ResumeAndExit as resumeAndExit and GetTargetId
	as getTargetId, make ConvertAddress member function
	convertAddress, add new member functions initHwPlatform,
	initDefaultMemoryMap, getMemoryMap, getRegisterMap,
	initAttachedCoreId, findSharedFunc, add pointers to DSO functions
	init_platform, close_platform, write_to, read_from, hw_reset,
	get_description, get_memory_map, get_number_supported_cores,
	set_chip_x_y, e_open, e_close, e_read, e_write, e_reset and
	e_set_host_verbosity
	* src/main.cpp: Add missing using declarations
	(skip_platform_reset): Deleted, now arg to constructor.
	(showMemoryMap): Get maps through accessors
	(initPlatform): Pass command line switches as arguments, ,
	initialze tCntrl and return as result.
	(main): Use EXIT_FAILURE and EXIT_SUCCESS result codes for
	consistency.

2014-01-28  Jeremy Bennett  <jeremy.bennett@embecosm.com>

	* src/main.cpp (initPlatform): Created from code to initialize in
	main function.
	(main): Remove initialization code into initPlatform.

2014-01-27  Jeremy Bennett  <jeremy.bennett@embecosm.com>

	* src/main.cpp (ThreadData, createGdbServer): Deleted.
	(main): Remove mainRetStatus, create a single port GdbServer.

2014-01-27  Jeremy Bennett  <jeremy.bennett@embecosm.com>

	* src/main.cpp: Include sstream.
	(platform_args): Deleted (replaced by platformArgs local to main.
	(show_memory_map): Deleted (replaced by doShowMemoryMap) local to
	main.
	(showMemoryMap): Created, based on code previously in main.
	(main): Make declaration of hdf_file local and change to hdfFile,
	make arg check use if-then-else structure, use stringstream to
	parse -Wpl, move code to show memory map to its own routine.

2014-01-27  Jeremy Bennett  <jeremy.bennett@embecosm.com>

	* Release/src/subdir.mk: Add CPPFLAGS to command line.
	* src/RspConnection.cpp (rspConnect): Add mutex around listen
	error message and report error details.
	* src/main.cpp: Make explicit which functions using applies to.
	(copyrightStr): Move as literal to copyright
	function.
	(revision): Delete and replace by defined value.
	(XDOREVSTR, DOREVSTR, REVSTR): New macros.
	(usage): Rewritten to include all options and remove all terminal
	specific control codes, takes argument to specify output stream.
	(usage_hidden): Deleted.
	(copyright): Unified to print all information consistently, using
	supplied revision string.
	(main): Return success if printing version or help, remove
	--help-hidden, replace usage and usage_hidden by usage with either
	cout or cerr as parameters, don't use designated initializer for
	ThreadData, since not standard C++ (C99 only).

2014-01-12  Jeremy Bennett  <jeremy.bennett@embecosm.com>

	* src/GdbServer.cpp (GdbServer): Pass haltOnAttach, ttyOut and
	withTtySupport flags to constructor, rather than as global variables.
	* src/GdbServer.h: New prototype for constructor, haltOnAttach,
	ttyOut and withTtySupport as member variables.
	* src/TargetControlHardware.cpp: Move e-xml and e-hal header
	includes to header file
	(TargetControlHardware): Pass in dontCheckHwAddress flag to
	constructor rather than as global variable.
	(initHwPlatform): New static member function rather than global.
	(initDefaultMemoryMap): New static member function rather than global.
	* src/TargetControlHardware.h: Add e-xml and e-hal header
	includes, update constructor prototype, new static functions
	initHwPlatform and initDefaultMemoryMap
	* src/main.cpp: haltOnAttach, ttyOut, withTtySupport and
	dontCheckHwAddress passed through relevant
	constructors. initHwPlatform and initDefaultMemoryMap as static
	member functions.
	(ThreadData): Struct for data to be used with pthread_create.

2014-01-12  Jeremy Bennett  <jeremy.bennett@embecosm.com>

	* Release/src/subdir.mk: Removed e_printf.c
	* src/e_printf.c: Deleted.
	* src/GdbServer.cpp (printWrapper): Created, based on
	printf_wrapper.
	* src/GdbServer.h (printfWrapper): New private member function
	replacing the global printf_wrapper.

2014-01-12  Jeremy Bennett  <jeremy.bennett@embecosm.com>

	* Release/src/subdir.mk: Renamed targetCntrlHardware as
	TargetControlHardware.
	* src/TargetControl.h: Renamed from targetCntrl.h for consistency.
	* src/TargetControlHardware.cpp: Renamed from
	targetCntrlHardware.cpp for consistency.
	* src/TargetControlHardware.h: Renamed from
	targetCntrlHardware.h for consistency.
	* src/GdbServer.h: Changed all references to targetCtrl to
	TargetControl.
	* src/TargetControl.h: Likewise.
	* src/TargetControlHardware.cpp: Likewise.
	* src/TargetControlHardware.h: Likewise.
	* src/main.cpp: Likewise.

2014-01-12  Jeremy Bennett  <jeremy.bennett@embecosm.com>

	* GdbServer.cpp: Replace SystemC types throughout.
	(GdbServer): Move constructor to this file from header.
	(is32BitsInstr): Made member function, replacing global Is32BitsInstr.
	(getfield, setfield): Made member functions, replacing global
	equivalents.
	(getAttachedTargetCoreId): Implementation moved here from
	definition file.
	* GdbServer.h: Remove all SystemC typedefs, replacing by the
	equivalent inttypes.h entry. Consolidate public and private member
	functions for clarity, move constructor to implementation file
	from definition file, make global functions member functions.
	(GdbServer): Implementation moved to implementation file.
	(getAttachedTargetCoreId): Made private and renamed from
	GetAttachedTargetCoreId, implementation moved to implementation
	file.
	(releaseGdbCmdSelectedCoreId): Made private and renamed from
	ReleaseGdbCmdSelectedCoreId.
	* targetCntrl.h: Get rid of typedefs for SystemC types, and
	replace with inttypes througout.
	* targetCntrlHardware.cpp: Likewise.
	* targetCntrlHardware.h: Likewise.

2014-01-12  Jeremy Bennett  <jeremy.bennett@embecosm.com>

	* Release/src/subdir.mk: Remove unneeded Gdbservercreate and rename
	GdbServerSC as GdbServer.
	* GdbServer.cpp: Renamed from GdbServerSC.cpp and all references
	internally updated.
	* GdbServer.h: Renamed from GdbServerSC.h and all references
	internally updated.
	* GdbserverCreate.cpp: Deleted
	* libgloss_syscall.h: Header comment change.
	* main.cpp: Incorporate GdbserverCreate and change reference to
	GdbServer from GdbServerSC.
	(createGdbServer): Renamed from CreateGdbServer.

2014-01-12  Jeremy Bennett  <jeremy.bennett@embecosm.com>

	* ChangeLog: Created.
	* Release/src/subdir.mk: Make stricter in error testing.
	* src/GdbServerSC.cpp: Return to GNU style, and enforce for emacs
	to facilitate comparision against upstream codebase.
	* src/GdbServerSC.h: Likewise.
	* src/GdbserverCreate.cpp: Likewise.
	* src/LoaderServer.h: Likewise.
	* src/MpHash.cpp: Likewise.
	* src/MpHash.h: Likewise.
	* src/RspConnection.cpp: Likewise.
	* src/RspConnection.h: Likewise.
	* src/RspPacket.cpp: Likewise.
	* src/RspPacket.h: Likewise.
	* src/Utils.cpp: Likewise.
	* src/Utils.h: Likewise.
	* src/debugVerbose.h: Likewise.
	* src/e_printf.cpp: Likewise.
	* src/libgloss_syscall.h: Likewise.
	* src/maddr_defs.h: Likewise.
	* src/main.cpp: Likewise.
	* src/targetCntrl.h: Likewise.
	* src/targetCntrlHardware.cpp: Likewise.
	* src/targetCntrlHardware.h: Likewise.
	* src/target_param.h: Likewise.
